# 기능 명세서: 반복 일정 종료 조건 설정

## 📋 기본 정보

- **Task ID**: task-20251031-215000
- **작성일**: 2025-10-31
- **작성자**: Feature Designer Agent
- **우선순위**: 중간
- **복잡도**: 중간 (medium)

---

## 🎯 기능 개요

반복 일정 생성 시 종료 조건을 지정할 수 있도록 하는 기능입니다. 사용자는 특정 날짜까지 반복하는 옵션을 선택할 수 있으며, 예제 애플리케이션 특성상 최대 2025-12-31까지 반복 일정을 생성할 수 있습니다.

---

## 👤 사용자 스토리

**As a** 캘린더 사용자  
**I want** 반복 일정의 종료 날짜를 지정하고 싶다  
**So that** 특정 기간 동안만 반복되는 일정을 관리할 수 있다

### 상세 시나리오

1. **기간 한정 반복 일정 생성**

   - 사용자: 매주 월요일 회의를 12월 말까지만 생성하고 싶다
   - 입력: 반복 유형 "매주", 종료일 "2025-12-31"
   - 결과: 2025-12-31까지의 모든 월요일에 일정이 생성됨

2. **종료일 없는 반복 일정 생성**

   - 사용자: 매일 알람을 무기한으로 설정하고 싶다
   - 입력: 반복 유형 "매일", 종료일 비워둠
   - 결과: 최대 100개까지 반복 일정이 생성됨

3. **과거 종료일 입력 방지**
   - 사용자: 실수로 일정 시작일보다 이전 날짜를 종료일로 입력
   - 입력: 시작일 "2025-11-10", 종료일 "2025-11-05"
   - 결과: 에러 메시지 표시, 일정 생성 안 됨

---

## ✅ 인수 조건 (Acceptance Criteria)

### 반복 일정 UI 활성화

1. [ ] "반복 일정" 체크박스를 체크하면 반복 설정 UI가 표시된다
2. [ ] 반복 설정 UI에는 다음 입력 필드가 포함된다:
   - 반복 유형 선택 (매일/매주/매월/매년)
   - 반복 간격 입력 (숫자)
   - 반복 종료일 입력 (날짜)
3. [ ] 반복 종료일 입력 필드는 선택적(optional)이다
4. [ ] 반복 종료일 입력 필드의 최대 날짜는 2025-12-31이다

### 반복 종료일 검증

5. [ ] 반복 종료일이 일정 시작일보다 이전인 경우 에러 메시지가 표시된다
   - 에러 메시지: "종료일은 시작일 이후여야 합니다"
6. [ ] 반복 종료일이 2025-12-31보다 이후인 경우 에러 메시지가 표시된다
   - 에러 메시지: "종료일은 2025-12-31 이전이어야 합니다"
7. [ ] 반복 종료일이 비어있는 경우 최대 100개까지 반복 일정이 생성된다
8. [ ] 반복 종료일이 입력된 경우 해당 날짜까지만 반복 일정이 생성된다

### 반복 일정 생성

9. [ ] 반복 종료일이 있는 경우, 종료일 이후의 일정은 생성되지 않는다
10. [ ] 생성된 반복 일정 개수가 사용자에게 표시된다
    - 예: "5개의 반복 일정이 생성되었습니다"
11. [ ] 반복 일정이 100개 이상인 경우 경고 메시지가 표시된다
    - 메시지: "반복 일정이 너무 많아 100개까지만 생성되었습니다"

### 반복 일정 표시

12. [ ] 일정 목록에서 반복 종료일 정보가 표시된다
    - 형식: "반복: 2주마다 (종료: 2025-12-31)"
13. [ ] 반복 종료일이 없는 경우 종료일 정보가 표시되지 않는다
    - 형식: "반복: 매일"

---

## 🔧 기술적 요구사항

### 관련 컴포넌트/파일

#### 수정 필요

- **`src/App.tsx`** (441-478줄) - 반복 일정 UI 활성화
  - 주석 제거
  - 반복 종료일 입력 필드에 `max="2025-12-31"` 속성 추가
  - 주석 처리된 `RepeatType` import 제거 (38줄)

#### 신규 생성 (선택적)

- **`src/utils/repeatEndDateValidation.ts`** - 반복 종료일 검증 유틸
  - `validateRepeatEndDate(startDate: string, endDate: string, maxDate: string): string | null`
  - 종료일이 시작일보다 이후인지 검증
  - 종료일이 최대 날짜 이내인지 검증
  - 에러가 없으면 `null`, 있으면 에러 메시지 반환

#### 수정 불필요 (이미 구현됨)

- `src/types.ts` - `RepeatInfo.endDate` 이미 정의됨
- `src/hooks/useEventForm.ts` - 반복 관련 상태 모두 준비됨
- `src/utils/repeatEventUtils.ts` - 종료일 처리 로직 구현됨
- `src/hooks/useEventOperations.ts` - 반복 일정 생성 로직 구현됨

### 필요한 타입 정의

기존 타입 활용 (수정 불필요):

```typescript
// src/types.ts (이미 정의됨)
export type RepeatType = 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly';

export interface RepeatInfo {
  type: RepeatType;
  interval: number;
  endDate?: string; // 이미 정의됨
}

export interface EventForm {
  // ...
  repeat: RepeatInfo;
}
```

### 검증 함수 명세 (신규)

```typescript
// src/utils/repeatEndDateValidation.ts

/**
 * 반복 종료일의 유효성을 검증합니다.
 * @param startDate 일정 시작일 (YYYY-MM-DD 형식)
 * @param endDate 반복 종료일 (YYYY-MM-DD 형식)
 * @param maxDate 최대 허용 날짜 (YYYY-MM-DD 형식)
 * @returns 에러 메시지 또는 null
 */
export function validateRepeatEndDate(
  startDate: string,
  endDate: string,
  maxDate: string = '2025-12-31'
): string | null {
  // 빈 종료일은 허용 (무제한 반복)
  if (!endDate) {
    return null;
  }

  const start = new Date(startDate);
  const end = new Date(endDate);
  const max = new Date(maxDate);

  // 종료일이 시작일보다 이전
  if (end < start) {
    return '종료일은 시작일 이후여야 합니다';
  }

  // 종료일이 최대 날짜보다 이후
  if (end > max) {
    return `종료일은 ${maxDate} 이전이어야 합니다`;
  }

  return null;
}
```

---

## 🎨 UI/UX 요구사항

### 레이아웃

- **반복 설정 섹션**:
  - "반복 일정" 체크박스 아래에 표시
  - 체크박스가 체크된 경우에만 보임
  - 세로 스택 레이아웃 (Stack spacing={2})

### 입력 필드

1. **반복 유형 선택**

   - Select 컴포넌트
   - 옵션: 매일, 매주, 매월, 매년
   - 레이블: "반복 유형"

2. **반복 간격 & 종료일**
   - 가로 스택 레이아웃 (2개 필드)
   - 반복 간격:
     - TextField (type="number")
     - 최소값: 1
     - 레이블: "반복 간격"
   - 반복 종료일:
     - TextField (type="date")
     - 최대값: 2025-12-31 (`max` 속성)
     - 레이블: "반복 종료일"
     - 선택적 (비워둘 수 있음)

### 인터랙션

- **날짜 입력**: HTML5 date picker 사용
- **검증**: 일정 추가/수정 버튼 클릭 시 검증
- **에러 표시**: Snackbar로 에러 메시지 표시

### 접근성

- 모든 입력 필드에 `FormLabel` 제공
- Select 컴포넌트에 `aria-label` 속성 추가
- 에러 메시지는 스크린 리더가 읽을 수 있도록 구현

---

## ⚠️ 제약사항 및 엣지 케이스

### 제약사항

1. **최대 날짜**: 2025-12-31까지만 허용 (예제 애플리케이션 특성)
2. **최대 개수**: 반복 일정은 최대 100개까지만 생성
3. **기존 로직 활용**: 이미 구현된 `generateRepeatEvents` 함수 재사용
4. **선택적 종료일**: 종료일은 필수가 아님 (무제한 반복 가능)

### 엣지 케이스

1. **종료일이 시작일보다 이전**

   - 입력: 시작일 "2025-11-15", 종료일 "2025-11-10"
   - 예상 동작: 에러 메시지 표시, 일정 생성 안 됨
   - 메시지: "종료일은 시작일 이후여야 합니다"

2. **종료일이 2025-12-31보다 이후**

   - 입력: 종료일 "2026-01-01"
   - 예상 동작: 브라우저 date picker에서 선택 불가 (`max` 속성)
   - 또는 직접 입력 시 에러 메시지 표시

3. **종료일 없음 (무제한 반복)**

   - 입력: 매일 반복, 종료일 비워둠
   - 예상 동작: 최대 100개까지 생성, 경고 메시지 표시

4. **종료일까지 1개의 일정만 생성되는 경우**

   - 입력: 시작일 "2025-12-30", 매주 반복, 종료일 "2025-12-31"
   - 예상 동작: 1개의 일정만 생성됨 (시작일만)

5. **매월/매년 반복 시 종료일 계산**

   - 입력: 1월 31일 시작, 매월 반복, 종료일 "2025-12-31"
   - 예상 동작: 31일이 없는 달은 건너뛰고 생성 (기존 로직 활용)

6. **윤년 2월 29일 매년 반복**

   - 입력: 2024-02-29 시작, 매년 반복, 종료일 "2028-12-31"
   - 예상 동작: 윤년에만 생성 (2024, 2028) (기존 로직 활용)

7. **일정 수정 시 반복 정보 유지**

   - 일정 수정 모드에서 기존 반복 정보가 폼에 표시됨
   - 종료일 정보도 함께 표시되어야 함
   - `useEventForm`의 `editEvent` 함수가 이미 처리함

8. **빈 문자열 종료일**
   - 입력: 종료일 필드에 날짜 입력 후 삭제하여 빈 문자열
   - 예상 동작: 무제한 반복으로 처리 (검증 통과)

---

## 📦 의존성

### 선행 작업

- **반복 일정 생성 기능** (task-20251031-000000) - ✅ 완료됨
  - `RepeatInfo` 타입 정의
  - `generateRepeatEvents` 함수
  - `useEventOperations`의 반복 일정 생성 로직

### 영향받는 영역

1. **일정 생성 UI** (`src/App.tsx`)

   - 반복 설정 UI가 활성화됨
   - 폼 영역이 길어짐 (스크롤 가능성)

2. **일정 검증 로직**

   - 반복 종료일 검증이 추가됨
   - 기존 시간 검증과 함께 수행

3. **일정 목록 표시**
   - 반복 종료일 정보가 표시됨 (이미 구현됨 - App.tsx 566줄)

---

## 📝 추가 노트

### 개발 시 고려사항

1. **최소 변경 원칙**

   - 주석만 제거하여 UI 활성화
   - 기존 코드 구조 유지
   - 이미 구현된 로직 최대한 재사용

2. **검증 로직 위치**

   - 간단한 검증: `addOrUpdateEvent` 함수 내부에서 처리
   - 복잡한 검증: 별도 유틸 함수로 분리 (`repeatEndDateValidation.ts`)

3. **사용자 경험**

   - 에러 메시지는 Snackbar로 명확하게 표시
   - 생성된 일정 개수를 사용자에게 알림
   - 100개 제한 시 경고 메시지 (이미 구현됨)

4. **테스트 전략**
   - 검증 함수는 유닛 테스트
   - UI 활성화 및 입력은 컴포넌트 테스트
   - 반복 일정 생성은 통합 테스트

### 향후 확장 가능성

- 반복 횟수 지정 (예: "10회만 반복")
- 특정 요일 선택 (예: "매주 월, 수, 금요일")
- 반복 일정 일괄 편집/삭제
- 반복 패턴 미리보기 캘린더

### 기존 구현 활용

이 기능은 대부분의 로직이 이미 구현되어 있어 주로 **UI 활성화**와 **검증 추가**에 초점을 맞춥니다:

- ✅ 타입 정의 (RepeatInfo.endDate)
- ✅ 상태 관리 (useEventForm)
- ✅ 반복 일정 생성 (generateRepeatEvents)
- ✅ 일정 저장 (useEventOperations)
- ✅ 종료일 표시 (App.tsx 일정 목록)

**새로 추가할 것:**

- UI 활성화 (주석 제거)
- 최대 날짜 제한 (`max` 속성)
- 종료일 검증 로직
- 테스트 코드

---

## ✔️ 검토 체크리스트

- [x] 사용자 스토리가 명확한가? - 종료 날짜 지정으로 기간 한정 반복 일정 관리
- [x] 인수 조건이 측정 가능한가? - 13개의 구체적인 조건
- [x] 엣지 케이스를 충분히 고려했는가? - 8가지 엣지 케이스 정의
- [x] 기존 코드와의 충돌은 없는가? - 기존 구현 재사용, 주석 제거만 필요
- [x] 접근성 요구사항을 포함했는가? - FormLabel, aria-label 명시
- [x] 구체적인 입력값과 결과값 예시가 포함되었는가? - 시나리오별 예시
- [x] 문서가 계층화되어 읽기 쉬운가? - 섹션별로 명확히 구분
- [x] 새로운 기능이 임의로 추가되지 않았는가? - 요구사항에만 집중
- [x] 작업 범위 분석 문서가 작성되었는가? - ✅ 작성 완료
